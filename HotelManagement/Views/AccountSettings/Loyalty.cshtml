@model HotelManagement.ViewModels.LoyaltyViewModel
@{
    ViewData["Title"] = "Program lojalnościowy";

    // ✅ Progi awansu wg liczby nocy
    var thresholds = new Dictionary<string, int>
    {
        { "Classic", 0 },
        { "Silver", 10 },
        { "Gold", 25 },
        { "Platinum", 50 },
        { "Diamond", 100 }
    };

    // ✅ Wyznacz kolejny poziom
    var nextLevel = thresholds
        .FirstOrDefault(t => t.Value > Model.TotalNights);

    var currentProgress = Model.TotalNights;
    var target = nextLevel.Value == 0 ? thresholds["Diamond"] : nextLevel.Value;
    var percent = Math.Min(100, (int)((double)currentProgress / target * 100));
}

<h2 class="mb-4">Program lojalnościowy</h2>

@if (string.IsNullOrEmpty(Model.LoyaltyCardNumber))
{
        <div class="alert alert-warning">
            Nie posiadasz jeszcze karty lojalnościowej.
        </div>
}
else
{
        <div class="card shadow-lg border-0 mb-4">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="card-title mb-1">
                        <i class="bi bi-person-badge"></i> Karta lojalnościowa
                    </h5>
                    <p class="mb-0 text-muted">Numer karty: <strong>@Model.LoyaltyCardNumber</strong></p>
                    <p class="mb-0 text-muted">
                        Status:
                        <span class="badge 
                        @(Model.LoyaltyStatus == "Classic" ? "bg-secondary" : 
                          Model.LoyaltyStatus == "Silver" ? "bg-light text-dark border" : 
                          Model.LoyaltyStatus == "Gold" ? "bg-warning text-dark" :
                          Model.LoyaltyStatus == "Platinum" ? "bg-info text-dark" : 
                          "bg-primary")">
                        @Model.LoyaltyStatus
                        </span>
                    </p>
                    <p class="mb-0 text-muted">Łączna liczba nocy: <strong>@Model.TotalNights</strong></p>

                    <!-- ✅ Pasek postępu -->
                @if (!string.IsNullOrEmpty(nextLevel.Key))
                {
                            <div class="mt-3">
                                <p class="mb-1 text-muted">
                                    Postęp do następnego statusu (<strong>@nextLevel.Key</strong>):
                                </p>
                                <div class="d-flex justify-content-between text-muted small mb-1">
                                    <span>@currentProgress / @target nocy</span>
                                    <span>cel: @target</span>
                                </div>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-success" role="progressbar"
                                         style="width:@percent%" aria-valuenow="@percent"
                                         aria-valuemin="0" aria-valuemax="100">
                                @percent%
                                    </div>
                                </div>
                            </div>
                }
                </div>
                <div class="text-end">
                    <h3 class="mb-0 text-success">@Model.LoyaltyPoints</h3>
                    <small class="text-muted">punktów</small>
                </div>
            </div>
        </div>

        <h4 class="mt-4 mb-3"><i class="bi bi-clock-history"></i> Historia punktów</h4>
        <table class="table table-striped table-hover shadow-sm">
            <thead class="table-light">
                <tr>
                    <th>Data</th>
                    <th>Punkty</th>
                    <th>Opis</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var item in Model.History)
            {
                    <tr>
                        <td>@item.AwardedAt.ToString("dd.MM.yyyy")</td>
                        <td>
                            <span class="badge @(item.Points >= 0 ? "bg-success" : "bg-danger")">
                            @(item.Points >= 0 ? "+" : "")@item.Points
                            </span>
                        </td>
                        <td>@item.Reason</td>
                    </tr>
            }
            </tbody>
        </table>
}
